<!DOCTYPE>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Создание объекта запроса</title>

    <script type="text/javascript">
        var HTTP = {};

        HTTP._factories = [
            function () { return new XMLHttpRequest(); }, // подходит для большинства браузеров.
        // для IE 5 и 6 в зависимости версии библиотек установленных на машине клиента.
            function () { return new ActiveXObject("Msxml2.XMLHTTP"); },
            function () { return new ActiveXObject("Microsoft.XMLHTTP"); },
        ];

        // в данном свойстве будет сохранена рабочая функция для создания объекта запроса.
        HTTP._factory = null;

        // Функция создает и возвращает новый объект типа XMLHttpRequest
        HTTP.newRequest = function () {
            if (HTTP._factory != null) return HTTP._factory;

            for (var i = 0; i < HTTP._factories.length; i++) {
                try {
                    var factory = HTTP._factories[i]
                    var request = factory();
                    if (request != null) {
                        HTTP._factory = factory;
                        return request;
                    }
                } catch (e) {
                    continue
                }
            }

            // Если выполнение дошло до данной строки - сценарию не удалось обнаружить  функцию для создания объекта XMLHttpRequest
            HTTP._factory = function () {
                throw new Error("Объект XMLHttpRequest не поддерживается");
            }

            // Генерация исключения.
            HTTP._factory();
        }

        var obj = HTTP.newRequest();
        console.log(obj);
    </script>
</head>
<body>
   
</body>
</html>